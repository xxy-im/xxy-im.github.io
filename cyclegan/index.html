<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<title class=pjax-title>[论文复现] CycleGAN - xxy's blog</title><meta name=Description content="xxy's blog"><meta property="og:title" content="[论文复现] CycleGAN">
<meta property="og:description" content="GAN来GAN去的CycleGAN">
<meta property="og:type" content="article">
<meta property="og:url" content="https://xxy.im/cyclegan/"><meta property="og:image" content="https://xxy.im/logo.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-06-15T04:34:11+08:00">
<meta property="article:modified_time" content="2022-06-15T04:34:11+08:00"><meta property="og:site_name" content="xxy's blog">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://xxy.im/logo.png">
<meta name=twitter:title content="[论文复现] CycleGAN">
<meta name=twitter:description content="GAN来GAN去的CycleGAN">
<meta name=application-name content="xxy != x²y">
<meta name=apple-mobile-web-app-title content="xxy != x²y">
<meta name=theme-color content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://xxy.im/cyclegan/><link rel=prev href=https://xxy.im/pix2pix/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload="this.onload=null,this.rel='stylesheet'" href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css>
<noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css></noscript><link rel=preload as=style onload="this.onload=null,this.rel='stylesheet'" href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css>
<noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"[论文复现] CycleGAN","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/xxy.im\/cyclegan\/"},"genre":"posts","keywords":"机器学习, 深度学习, 论文复现, GAN","wordcount":2768,"url":"https:\/\/xxy.im\/cyclegan\/","datePublished":"2022-06-15T04:34:11+08:00","dateModified":"2022-06-15T04:34:11+08:00","publisher":{"@type":"Organization","name":"xxy"},"author":{"@type":"Person","name":"xxy"},"description":""}</script></head>
<body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(a){document.body.setAttribute('theme',a)}function saveTheme(a){window.localStorage&&localStorage.setItem('theme',a)}function getMeta(b){const a=document.getElementsByTagName('meta');for(let c=0;c<a.length;c++)if(a[c].getAttribute('name')===b)return a[c];return''}if(window.localStorage&&localStorage.getItem('theme')){let a=localStorage.getItem('theme');a==='light'||a==='dark'||a==='black'?setTheme(a):window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches?setTheme('dark'):setTheme('light')}else'auto'==='light'||'auto'==='dark'||'auto'==='black'?(setTheme('auto'),saveTheme('auto')):(saveTheme('auto'),window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches?setTheme('dark'):setTheme('light'));let metaColors={light:'#f8f8f8',dark:'#252627',black:'#000000'};getMeta('theme-color').content=metaColors[document.body.getAttribute('theme')]</script>
<div id=back-to-top></div>
<div id=mask></div><div class=wrapper><header class=desktop id=header-desktop>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="xxy's blog"><span class=header-title-pre><i class="fa fa-fighter-jet"></i></span><span id=id-1 class=typeit></span></a>
</div>
<div class=menu>
<div class=menu-inner><a class=menu-item href=/posts/> 所有文章 </a><a class=menu-item href=/tags/> 标签 </a><a class=menu-item href=/categories/> 分类 </a><a class=menu-item href=https://github.com/xxy-im title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=# onclick=return!1 class="search-button search-toggle" id=search-toggle-desktop title=搜索>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=# onclick=return!1 class="search-button search-clear" id=search-clear-desktop title=清空>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-desktop>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</span><a href=# onclick=return!1 class="menu-item theme-select" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
<select class=color-theme-select id=theme-select-desktop title=切换主题><option value=light>浅色</option><option value=dark>深色</option><option value=black>黑色</option><option value=auto>跟随系统</option></select>
</a></div>
</div>
</div>
</header><header class=mobile id=header-mobile>
<div class=header-container>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="xxy's blog"><span class=header-title-pre><i class="fa fa-fighter-jet"></i></span><span id=id-2 class=typeit></span></a>
</div>
<div class=menu-toggle id=menu-toggle-mobile>
<span></span><span></span><span></span>
</div>
</div>
<div class=menu id=menu-mobile><div class=search-wrapper>
<div class="search mobile" id=search-mobile>
<input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=# onclick=return!1 class="search-button search-toggle" id=search-toggle-mobile title=搜索>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=# onclick=return!1 class="search-button search-clear" id=search-clear-mobile title=清空>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-mobile>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</div>
<a href=# onclick=return!1 class=search-cancel id=search-cancel-mobile>
取消
</a>
</div><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=https://github.com/xxy-im title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><a href=# onclick=return!1 class="menu-item theme-select" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
<select class=color-theme-select id=theme-select-mobile title=切换主题><option value=light>浅色</option><option value=dark>深色</option><option value=black>黑色</option><option value=auto>跟随系统</option></select>
</a></div>
</div>
</header>
<div class="search-dropdown desktop">
<div id=search-dropdown-desktop></div>
</div>
<div class="search-dropdown mobile">
<div id=search-dropdown-mobile></div>
</div>
<main class=main>
<div class=container><div class=toc id=toc-auto>
<h2 class=toc-title>目录</h2>
<div class=toc-content id=toc-content-auto></div>
</div><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle","normal")</script><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">[论文复现] CycleGAN</h1><div class=post-meta>
<div class=post-meta-line>
<span class=post-author><i class="author fas fa-user-circle fa-fw"></i><a href=https://xxy.im title=Author target=_blank rel="noopener noreffer author" class=author>xxy</a>
</span>&nbsp;<span class=post-category>收录于 </span>&nbsp;<span class=post-category>类别 <a href=/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/><i class="far fa-folder fa-fw"></i>深度学习</a></span></div>
<div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-06-15>2022-06-15</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2022-06-15>2022-06-15</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2768 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 6 分钟&nbsp;<span id=/cyclegan/ class=leancloud_visitors data-flag-title="[论文复现] CycleGAN">
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count id=twikoo_visitors></span>&nbsp;次阅读
</span>&nbsp;<span id=/cyclegan/ class=comment_count data-flag-title="[论文复现] CycleGAN">
<i class="far fa-comments fa-fw"></i>&nbsp;<span class=twikoo-comment-count id=twikoo-comment-count></span>&nbsp;条评论
</span>&nbsp;</div>
</div><div class=featured-image><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/cyclegan.png data-srcset="https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/cyclegan.png, https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/cyclegan.png 1.5x, https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/cyclegan.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/cyclegan.png title=https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/cyclegan.png height=auto width=auto></div><div class="details toc" id=toc-static kept>
<div class="details-summary toc-title">
<span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span>
</div>
<div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents>
<ul>
<li><a href=#概述>概述</a></li>
<li><a href=#模型及训练>模型及训练</a>
<ul>
<li><a href=#生成器>生成器</a></li>
<li><a href=#判别器>判别器</a></li>
<li><a href=#目标函数>目标函数</a></li>
<li><a href=#训练细节>训练细节</a></li>
</ul>
</li>
<li><a href=#核心代码>核心代码</a></li>
<li><a href=#效果>效果</a></li>
<li><a href=#总结>总结</a></li>
</ul>
</nav></div>
</div><div class=content id=content><p>GAN来GAN去的CycleGAN</p>
<h1 id=unpaired-image-to-image-translation-using-cycle-consistent-adversarial-networks>Unpaired Image-to-Image Translation using Cycle-Consistent Adversarial Networks</h1>
<p>论文下载地址：<br>
<a href=https://arxiv.org/pdf/1703.10593.pdf target=_blank rel="noopener noreffer">https://arxiv.org/pdf/1703.10593.pdf</a></p>
<p>文章其实早就写好了，但是一直没有卡测试代码所以就没发，<del>这次真不是懒</del></p>
<p>最后还是只有一块很差的卡给我用，一个epoch要跑半小时☹️</p>
<h2 id=概述>概述</h2>
<p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/unpaired.png data-srcset="https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/unpaired.png, https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/unpaired.png 1.5x, https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/unpaired.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/unpaired.png title=与pix2pix的区别></p>
<p>这篇论文和pix2pix是同一个团队，pix2pix的输入输出图片属于是像素级对应的，训练时需要成对的样本数据集（paired）。而这篇论文和pix2pix相比多了一个<strong>Unpaired</strong>，相较pix2pix往前再走了一步，可以不需要成对的样本便能训练出较好的图像迁移模型。从论文开篇的风格迁移示例可以看出，A图转成B图的同时B也可以转成A，所以称为<strong>CycleGAN</strong>。换句话说，CycleGAN解决的是两个不同的图像域之间相互转换的问题。</p>
<p><em>有前面几篇GAN的基础的话，很容易就能看懂这篇论文</em></p>
<p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/cyc-loss.png data-srcset="https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/cyc-loss.png, https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/cyc-loss.png 1.5x, https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/cyc-loss.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/cyc-loss.png title="Cycle-consistency loss"></p>
<p>CycleGAN和之前学过的GAN不同的地方是它有两个GAN（两个生成器，两个判别器），以及两个<strong>cycle-consistency loss</strong>。X和Y是两个不同风格的数据集，生成器$G$为$X$风格照片生成对应的Y风格的照片，即$G(X)\rightarrow Y$。判别器$D_X$则判别图片是否为$X$的风格。生成器$F$则将输入的$Y$风格的照片转化为$X$风格的照片，即$F(Y)\rightarrow X$。判别器$D_Y$则判别图片是否为$Y$风格的照片。而<strong>cycle-consistency loss</strong>可以计算原风格图与对应生成图片转回为原风格图片，即$X$与$F(G(X))$之间的误差，防止相互转换时丢失信息。这个$F$就有点类似$G$的反函数的感觉，而$G$就像是$X$和$Y$两个图像域之间的双射函数（两个域的图片数量不需要一样）。论文里用了一个语言翻译的例子描述<strong>cycle consistent（循环一致性）</strong>。一句英文翻译成对应的法文后，这句法文翻译回英文时能得到和原英文一样的句子，这就叫<strong>循环一致性</strong>。而cycle-consistency loss 的目的就是使得$F(G(x))\approx x$以及$G(F(y))\approx y$。将这两个cycle-consistency loss与两个GAN的loss结合起来便是整个CycleGAN的loss。</p>
<h2 id=模型及训练>模型及训练</h2>
<h3 id=生成器>生成器</h3>
<p>生成网络参考的是Justin Johnson（李飞飞实验室）论文《Perceptual Losses for Real-Time Style Transfer and Super-Resolution》里面的用到了图像风格迁移网络。</p>
<p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/residual-gen.png data-srcset="https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/residual-gen.png, https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/residual-gen.png 1.5x, https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/residual-gen.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/residual-gen.png title="CycleGAN 生成器"></p>
<p>对于不同的图片输入大小残差块数量不同。若输入图片大小为128x128则残差块有6个，大于等于256x256的有9个。在论文的附录7中给出了详细的网络结构。</p>
<p><strong>6残差块结构：</strong></p>
<p>c7s1-64, d128, d256, R256, R256, R256, R256, R256, R256, u128, u64, c7s1-3</p>
<p><strong>9残差块结构：</strong></p>
<p>c7s1-64, d128, d256, R256, R256, R256, R256, R256, R256, R256, R256, R256, u128, u64, c7s1-3</p>
<blockquote>
<ul>
<li>c7s1-64表示卷积核大小为7，步长为1，输出通道为64的卷积层</li>
<li>d128表示输出通道为128的下采样卷积层</li>
<li>R256表示输出通道为256的残差块</li>
<li>u128表示输出通道为128的上采样卷积层</li>
</ul>
</blockquote>
<p>上采样通过stride=1/2实现，即将输入特征先扩大一倍再通过stride为1的卷积核计算，这样就等同于stride为1/2。</p>
<p>对于前后两个<strong>c7s1</strong>的卷积层是不改变输入特征宽高的，所以padding为3。风格迁移中常用的padding操作是<strong>镜像填充（ReflectionPad）</strong>，镜像填充的方式相比于使用固定数值进行填充有可能获得更好的卷积结果。</p>
<h3 id=判别器>判别器</h3>
<p>判别器和pix2pix的判别器一样用的是 70x70的PatchGAN，略过。</p>
<h3 id=目标函数>目标函数</h3>
<p><strong>Cycle-consistency loss：</strong></p>
<p>$$
\mathcal{L}_ {\text {cyc }}(G, F) =\mathbb{E}_{x \sim p_{\text {data }}(x)}\left[|F(G(x))-x|_{1}\right] + \mathbb{E}_{y \sim p_{\text {data }}(y)}\left[|G(F(y))-y|_{1}\right]
$$</p>
<p>有点类似<strong>pix2pix</strong>里在原loss后面加的那个L1距离，因为cycle-consistency loss得保证$x$同$F(G(x))$之间的<strong>paired</strong>。<em>cyc loss 的引入使得训练时两个生成器需要同时更新参数（可以使用itertools.chain）</em></p>
<p><strong>CycleGAN完整的目标函数：</strong></p>
<p>$$
\begin{aligned}\mathcal{L}\left(G, F, D_{X}, D_{Y}\right) &=\mathcal{L}_{\mathrm{GAN}}\left(G, D_{Y}, X, Y\right) \&+\mathcal{L}_{\mathrm{GAN}}\left(F, D_{X}, Y, X\right) \&+\lambda \mathcal{L}_{\text {cyc }}(G, F)\end{aligned}
$$</p>
<p>$\lambda$用于控制两个目标之间的循环一致性强度。论文中训练时$\lambda$设为10</p>
<h3 id=训练细节>训练细节</h3>
<p>为了模型训练的稳定性，GAN的loss函数不再使用原生GAN那样的对数似然函数，而是使用最小二乘损失函数。即对于训练生成器$G$，目标是最小化$\mathbb{E}_ {x \sim p_ {\text {data }}(x)}\left[(D(G(x))-1)^{2}\right]$，对于训练判别器$D$，目标是最小化$\mathbb{E}_{y \sim p_{\text {data }}(y)}\left[(D(y)-1)^{2}\right] + \mathbb{E}_{x \sim p_{\text {data }}(x)}\left[D(G(x))^{2}\right]$。这样可以使得GAN模型训练更稳定，且生成更高质量的结果。（参考 Least squares generative adversarial networks. In CVPR. IEEE, 2017.）</p>
<p>还有一个防止模型震荡的方法。维护一个容量为50的图片缓存用于存储之前生成的50张图片，而不是使用生成器最新生成的图片。（参考 Learning from simulated and unsupervised images through adversarial training. In CVPR, 2017.）</p>
<p>使用Adam优化器，batch size设为1，学习率为0.0002，前100个epoch学习率相同，后100个epoch学习率线性衰退为0。所以需要用到<strong>lr_scheduler</strong>。</p>
<p>模型权重初始化使用高斯分布$N(0, 0.02)$</p>
<p>对于<strong>painting→photo</strong>任务，论文中提到可以在损失函数中多加一项$\mathcal{L}_{\text {identity }}(G, F)$</p>
<p>$$
\mathcal{L}_ {\text {identity }}(G, F)=\mathbb{E}_{y \sim p_{\text {data }}(y)}\left[|G(y)-y|_{1}\right]+   \mathbb{E}_{x \sim p_{\text {data }}(x)}\left[|F(x)-x|_{1}\right] 
$$</p>
<p>这样可以使生成图与原图保持色彩分布的一致性</p>
<h2 id=核心代码>核心代码</h2>
<p><strong>生成器：</strong></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>build_cbr_block</span><span class=p>(</span><span class=n>in_channels</span><span class=p>,</span> <span class=n>out_channels</span><span class=p>,</span> <span class=n>kernel_size</span><span class=p>,</span> <span class=n>stride</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>padding</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
                    <span class=n>activation</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>normalize</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>reflect_pad</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
    <span class=n>layers</span> <span class=o>=</span> <span class=p>[]</span>

    <span class=k>if</span> <span class=n>reflect_pad</span><span class=p>:</span>
        <span class=n>layers</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>nn</span><span class=o>.</span><span class=n>ReflectionPad2d</span><span class=p>(</span><span class=n>padding</span><span class=p>))</span>
        <span class=n>padding</span> <span class=o>=</span> <span class=mi>0</span>

    <span class=n>layers</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
        <span class=n>nn</span><span class=o>.</span><span class=n>Conv2d</span><span class=p>(</span>
            <span class=n>in_channels</span><span class=p>,</span>
            <span class=n>out_channels</span><span class=p>,</span>
            <span class=n>kernel_size</span><span class=o>=</span><span class=n>kernel_size</span><span class=p>,</span>
            <span class=n>stride</span><span class=o>=</span><span class=n>stride</span><span class=p>,</span>
            <span class=n>padding</span><span class=o>=</span><span class=n>padding</span><span class=p>,</span>
            <span class=n>bias</span><span class=o>=</span><span class=kc>False</span> <span class=k>if</span> <span class=n>normalize</span> <span class=k>else</span> <span class=kc>True</span>
        <span class=p>),</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=n>normalize</span><span class=p>:</span>
        <span class=n>layers</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>nn</span><span class=o>.</span><span class=n>InstanceNorm2d</span><span class=p>(</span><span class=n>out_channels</span><span class=p>))</span>

    <span class=k>if</span> <span class=n>activation</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>layers</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>activation</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>layers</span>

<span class=k>class</span> <span class=nc>ResidualBlock</span><span class=p>(</span><span class=n>nn</span><span class=o>.</span><span class=n>Module</span><span class=p>):</span>
    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>in_channels</span><span class=p>,</span> <span class=n>reflect_pad</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>block</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Sequential</span><span class=p>(</span>
            <span class=o>*</span><span class=n>build_cbr_block</span><span class=p>(</span><span class=n>in_channels</span><span class=p>,</span> <span class=n>in_channels</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>nn</span><span class=o>.</span><span class=n>ReLU</span><span class=p>(</span><span class=kc>True</span><span class=p>)),</span>
            <span class=o>*</span><span class=n>build_cbr_block</span><span class=p>(</span><span class=n>in_channels</span><span class=p>,</span> <span class=n>in_channels</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
        <span class=p>)</span>

    <span class=k>def</span> <span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>x</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>block</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>

<span class=k>class</span> <span class=nc>ResidualGenerator</span><span class=p>(</span><span class=n>nn</span><span class=o>.</span><span class=n>Module</span><span class=p>):</span>
    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>in_channels</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>res_nums</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span> <span class=n>reflect_pad</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>init_weights</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>

        <span class=n>conv_channels</span> <span class=o>=</span> <span class=p>[</span><span class=mi>64</span><span class=p>,</span> <span class=mi>128</span><span class=p>,</span> <span class=mi>256</span><span class=p>,</span> <span class=mi>128</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>

        <span class=n>blocks</span> <span class=o>=</span> <span class=p>[</span>
            <span class=o>*</span><span class=n>build_cbr_block</span><span class=p>(</span><span class=n>in_channels</span><span class=p>,</span> <span class=n>conv_channels</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
                             <span class=n>kernel_size</span><span class=o>=</span><span class=mi>7</span><span class=p>,</span> <span class=n>stride</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>padding</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>activation</span><span class=o>=</span><span class=n>nn</span><span class=o>.</span><span class=n>ReLU</span><span class=p>(</span><span class=kc>True</span><span class=p>)),</span>

            <span class=c1># downsampling</span>
            <span class=o>*</span><span class=n>build_cbr_block</span><span class=p>(</span><span class=n>conv_channels</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>conv_channels</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span>
                             <span class=n>kernel_size</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>stride</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>padding</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>activation</span><span class=o>=</span><span class=n>nn</span><span class=o>.</span><span class=n>ReLU</span><span class=p>(</span><span class=kc>True</span><span class=p>),</span> <span class=n>reflect_pad</span><span class=o>=</span><span class=kc>False</span><span class=p>),</span>
            <span class=o>*</span><span class=n>build_cbr_block</span><span class=p>(</span><span class=n>conv_channels</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>conv_channels</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span>
                             <span class=n>kernel_size</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>stride</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>padding</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>activation</span><span class=o>=</span><span class=n>nn</span><span class=o>.</span><span class=n>ReLU</span><span class=p>(</span><span class=kc>True</span><span class=p>),</span> <span class=n>reflect_pad</span><span class=o>=</span><span class=kc>False</span><span class=p>),</span>
        <span class=p>]</span>

        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>res_nums</span><span class=p>):</span>
            <span class=n>blocks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>ResidualBlock</span><span class=p>(</span><span class=n>conv_channels</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>reflect_pad</span><span class=p>))</span>

        <span class=c1># upsampling</span>
        <span class=n>blocks</span> <span class=o>+=</span> <span class=p>[</span>
            <span class=n>nn</span><span class=o>.</span><span class=n>Upsample</span><span class=p>(</span><span class=n>scale_factor</span><span class=o>=</span><span class=mi>2</span><span class=p>),</span>
            <span class=o>*</span><span class=n>build_cbr_block</span><span class=p>(</span><span class=n>conv_channels</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>conv_channels</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>
                             <span class=n>kernel_size</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>stride</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>padding</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>activation</span><span class=o>=</span><span class=n>nn</span><span class=o>.</span><span class=n>ReLU</span><span class=p>(</span><span class=kc>True</span><span class=p>),</span> <span class=n>reflect_pad</span><span class=o>=</span><span class=kc>False</span><span class=p>),</span>
            <span class=n>nn</span><span class=o>.</span><span class=n>Upsample</span><span class=p>(</span><span class=n>scale_factor</span><span class=o>=</span><span class=mi>2</span><span class=p>),</span>
            <span class=o>*</span><span class=n>build_cbr_block</span><span class=p>(</span><span class=n>conv_channels</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span> <span class=n>conv_channels</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span>
                             <span class=n>kernel_size</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>stride</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>padding</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>activation</span><span class=o>=</span><span class=n>nn</span><span class=o>.</span><span class=n>ReLU</span><span class=p>(</span><span class=kc>True</span><span class=p>),</span> <span class=n>reflect_pad</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
        <span class=p>]</span>

        <span class=c1># map to RGB</span>
        <span class=n>blocks</span> <span class=o>+=</span> <span class=p>[</span>
            <span class=o>*</span><span class=n>build_cbr_block</span><span class=p>(</span><span class=n>conv_channels</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=n>conv_channels</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span>
                             <span class=n>kernel_size</span><span class=o>=</span><span class=mi>7</span><span class=p>,</span> <span class=n>stride</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>padding</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>activation</span><span class=o>=</span><span class=n>nn</span><span class=o>.</span><span class=n>Tanh</span><span class=p>(),</span> <span class=n>normalize</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
        <span class=p>]</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>net</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Sequential</span><span class=p>(</span><span class=o>*</span><span class=n>blocks</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>init_weights</span><span class=p>:</span>
            <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>modules</span><span class=p>():</span>
                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>nn</span><span class=o>.</span><span class=n>Conv2d</span><span class=p>):</span>
                    <span class=n>nn</span><span class=o>.</span><span class=n>init</span><span class=o>.</span><span class=n>normal_</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>weight</span><span class=p>,</span> <span class=n>mean</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>std</span><span class=o>=</span><span class=mf>0.02</span><span class=p>)</span>
                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>nn</span><span class=o>.</span><span class=n>BatchNorm2d</span><span class=p>):</span>
                    <span class=n>nn</span><span class=o>.</span><span class=n>init</span><span class=o>.</span><span class=n>normal_</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>weight</span><span class=p>,</span> <span class=n>mean</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>std</span><span class=o>=</span><span class=mf>0.02</span><span class=p>)</span>
                    <span class=k>if</span> <span class=n>m</span><span class=o>.</span><span class=n>bias</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                        <span class=n>nn</span><span class=o>.</span><span class=n>init</span><span class=o>.</span><span class=n>constant_</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>bias</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>

    <span class=k>def</span> <span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>net</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Cycle-consistency loss：</strong></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>cyc_loss</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>L1Loss</span><span class=p>()</span>
<span class=n>loss_cyc_a</span> <span class=o>=</span> <span class=n>cyc_loss</span><span class=p>(</span><span class=n>G_BA</span><span class=p>(</span><span class=n>fake_B</span><span class=p>),</span> <span class=n>real_A</span><span class=p>)</span>
<span class=n>loss_cyc_b</span> <span class=o>=</span> <span class=n>cyc_loss</span><span class=p>(</span><span class=n>G_AB</span><span class=p>(</span><span class=n>fake_A</span><span class=p>),</span> <span class=n>real_B</span><span class=p>)</span>
<span class=n>loss_cycle</span> <span class=o>=</span> <span class=p>(</span><span class=n>loss_cyc_a</span> <span class=o>+</span> <span class=n>loss_cyc_b</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>L_identity：</strong></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>l_identity</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>L1Loss</span><span class=p>()</span>
<span class=n>loss_id_a</span> <span class=o>=</span> <span class=n>l_identity</span><span class=p>(</span><span class=n>G_BA</span><span class=p>(</span><span class=n>real_A</span><span class=p>),</span> <span class=n>real_A</span><span class=p>)</span>
<span class=n>loss_id_b</span> <span class=o>=</span> <span class=n>l_identity</span><span class=p>(</span><span class=n>G_AB</span><span class=p>(</span><span class=n>real_B</span><span class=p>),</span> <span class=n>real_B</span><span class=p>)</span>
<span class=n>loss_identity</span> <span class=o>=</span> <span class=p>(</span><span class=n>loss_id_a</span> <span class=o>+</span> <span class=n>loss_id_b</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=效果>效果</h2>
<p>训练速度实在感人，所以最后只跑了几十个epoch。感觉照片转梵高风格的效果要比梵高转照片效果好。梵高风格画转照片的画我发现有水有云的转换效果最好，碰到人物画像多半不行。截了些相对较好的效果图出来。</p>
<p>数据集下载：</p>
<p>链接：https://pan.baidu.com/s/1TTu-fe4J2FaJW42RmTMJvg?pwd=d6az<br>
提取码：d6az</p>
<p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/vangogh2photo.png data-srcset="https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/vangogh2photo.png, https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/vangogh2photo.png 1.5x, https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/vangogh2photo.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/vangogh2photo.png title=梵高风格转照片></p>
<p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/photo2vangogh.png data-srcset="https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/photo2vangogh.png, https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/photo2vangogh.png 1.5x, https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/photo2vangogh.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/photo2vangogh.png title=照片转梵高风格画></p>
<p>完整代码：<br>
<a href=https://github.com/xxy-im/Just4GAN/tree/main/models/cyclegan target=_blank rel="noopener noreffer">https://github.com/xxy-im/Just4GAN/tree/main/models/cyclegan</a></p>
<h2 id=总结>总结</h2>
<p><del>没啥好总结的，没卡玩个毛深度学习啊</del></p>
<p>继续GAN</p>
<p><em>最近有几位新朋友关注了我，突然又有了继续写下去的动力。</em></p></div><div class=post-footer id=post-footer>
<div class=post-info>
<div class=post-info-line>
<div class=post-info-mod>
<span>更新于 2022-06-15</span>
</div>
<div class=post-info-license></div>
</div>
<div class=post-info-line>
<div class=post-info-md></div>
<div class=post-info-share>
<span><a href=# onclick=return!1 title="分享到 Twitter" data-sharer=twitter data-url=https://xxy.im/cyclegan/ data-title="[论文复现] CycleGAN" data-hashtags=机器学习,深度学习,论文复现,GAN><i class="fab fa-twitter fa-fw"></i></a><a href=# onclick=return!1 title="分享到 Facebook" data-sharer=facebook data-url=https://xxy.im/cyclegan/ data-hashtag=机器学习><i class="fab fa-facebook-square fa-fw"></i></a><a href=# onclick=return!1 title="分享到 Line" data-sharer=line data-url=https://xxy.im/cyclegan/ data-title="[论文复现] CycleGAN"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@v5.8.1/icons/line.svg></i></a><a href=# onclick=return!1 title="分享到 微博" data-sharer=weibo data-url=https://xxy.im/cyclegan/ data-title="[论文复现] CycleGAN" data-image=https://cdn.jsdelivr.net/gh/xxy-im/storage@gh-pages/images/cyclegan.png><i class="fab fa-weibo fa-fw"></i></a><a href=# onclick=return!1 title="分享到 Myspace" data-sharer=myspace data-url=https://xxy.im/cyclegan/ data-title="[论文复现] CycleGAN" data-description><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@v5.8.1/icons/myspace.svg></i></a><a href=# onclick=return!1 title="分享到 Blogger" data-sharer=blogger data-url=https://xxy.im/cyclegan/ data-title="[论文复现] CycleGAN" data-description><i class="fab fa-blogger fa-fw"></i></a><a href=# onclick=return!1 title="分享到 Evernote" data-sharer=evernote data-url=https://xxy.im/cyclegan/ data-title="[论文复现] CycleGAN"><i class="fab fa-evernote fa-fw"></i></a></span>
</div>
</div>
</div>
<div class=post-info-more>
<section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/>机器学习</a>,&nbsp;<a href=/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/>深度学习</a>,&nbsp;<a href=/tags/%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/>论文复现</a>,&nbsp;<a href=/tags/gan/>GAN</a></section>
<section>
<span><a href=# onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span>
</section>
</div>
<div class=post-nav><a href=/pix2pix/ class=prev rel=prev title="[论文复现] pix2pix"><i class="fas fa-angle-left fa-fw"></i>[论文复现] pix2pix</a></div>
</div>
<div id=comments><div id=twikoo></div><noscript>
Please enable JavaScript to view the comments powered by <a href=https://twikoo.js.org/>Twikoo</a>.
</noscript></div></article></div>
</main><footer class=footer>
<div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://xxy.im target=_blank rel="noopener noreferrer">xxy</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div>
</div></footer></div>
<div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title=回到顶部>
<i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论>
<i class="fas fa-comment fa-fw"></i>
</a>
</div><div class=assets><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.0/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/topbar@1.0.1/topbar.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/@sliphua/pjax@0.13.0/dist/pjax.min.js></script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-V9ZE6MC9MQ',{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-V9ZE6MC9MQ" async></script></div>
<div class=pjax-assets><script type=text/javascript src=https://cdn.jsdelivr.net/npm/twikoo@1.4.3/dist/twikoo.all.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/twemoji@13.1.0/dist/twemoji.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/mhchem.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js></script><script type=text/javascript src=/js/click_effect.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/live2d-widget@3.1.4/lib/L2Dwidget.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/live2d-widget@3.1.4/lib/L2Dwidget.0.min.js></script><script type=text/javascript src=/js/live2d_config.js></script><script type=text/javascript src=/js/console_output.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{twikoo:{commentCount:!0,el:"#twikoo",envId:"https://twikoo-livid.vercel.app/",lang:"zh-cn"}},data:{"id-1":"  xxy != x²y","id-2":"  xxy != x²y"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:50,threshold:.3,type:"fuse",useExtendedSearch:!1},sharerjs:!0,twemoji:!0,typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"id-1":["id-1"],"id-2":["id-2"]},duration:-1,speed:100}}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/copy-tex.min.css></div>
</body>
</html>